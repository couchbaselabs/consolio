<div ng-show="auth.loggedin">
    <h1>Dashboard</h1>
    <br/>


    <div>
        <h4>Your Sync Gateways <button class="btn btn-xs btn-success" ng-disabled="wantNewSGW" ng-click="wantNewSGW = true"><span class="icon-plus"></span> New Sync Gateway</button></h4>
        <hr>
        <div ng-show="wantNewSGW" class="animate-if well">
            <form name="form_createNewSGW" novalidate>
                <h3>Create a new Sync Gateway</h3>
                <table cellpadding="5">
                    <tbody>
                    <tr>
                        <td>Name</td>
                        <td><input class="form-control" ng-bind="newSGW_name" id="newSGW_name" type="text" min="3" max="15" style="width: 200px;"/> <span ng-show="form_createNewSGW.newSGW_name.$error.min || form_createNewSGW.newSGW_name.$error.max">Must be at least 3 characters!</span></td>
                    </tr>
                    <tr>
                        <td>Allow Guest?</td>
                        <td><input type="checkbox" id="newSGW_guest"/></td>
                    </tr>
                    <tr>
                        <td>Sync Function</td>
                        <td><cb-editor live="1" editing="wantNewSGW" id="newSGW_sync"
                                      source="newSGW_sync" editfn="sync_edit_toggle"></cb-editor></td>
                    </tr>
                    <tr><td></td><td>
                        <button class="btn btn-danger btn-sm" ng-click="wantNewSGW = false">Cancel</button>&nbsp;
                        <button class="btn btn-success btn-sm" ng-click="createNewSGW()">Create</button>
                    </td></tr>
                    </tbody>
                </table>
                <br/>
            </form>
        </div>

        <p ng-hide="syncgws"><em>No sync gateways created yet...</em></p>
        <table id="sgw-list" class="table table-hover" ng-show="syncgws">
            <thead>
            <th>Name</th>
            <th>Urls</th>
            <th>Status</th>
            <th>Storage</th>
            <th>Average Usage</th>
            <th>&nbsp;</th>
            </thead>


            <tbody ng-repeat="d in syncgws" ng-switch="row.configure" ng-init="row={configure:false}">

            <!-- Displayed when not configuring -->
            <tr ng-switch-default>
                <td><a href="/sgw/{{d.name}}/"><span class="sgw-name">{{d.name}}</span></a></td>
                <td><span class="sgw-url">Sync</span>
                    <button id="sgw-{{$index}}" class="zerocopy-button" ng-click="clickSyncUrlButton($index)"
                            data-clipboard-text="http://sync.couchbasecloud.com/{{d.name}}"><span
                            class="glyphicon icon-copy"></span></button>
                    &nbsp;&nbsp;&nbsp;
                    <span class="sgw-url">Admin</span>
                    <button id="sgwa-{{$index}}" class="zerocopy-button" ng-click="clickAdminSyncUrlButton($index)"
                            data-clipboard-text="http://login:password@sync.couchbasecloud.com/{{d.name}}"><span
                            class="glyphicon icon-copy"></span></button>
                </td>
                <td>{{d.state.length == 0 ? "unknown" : d.state}}</td>
                <td>{{d.stats ? d.stats.size + " of 500 MB" : "unknown"}}</td>
                <td>xxx ops/day {{console.log(d)}}</td>
                <td ng-if="row.configure=false" style="text-align: right;">
                    <button class="btn btn-info" ng-click="row.configure=true;editor.focus">configure</button>
                    &nbsp;
                    <button ng-click="delete({{$index}})" class="btn btn-danger">Delete</button>
                </td>
            </tr>

            <!-- Displayed when configuring -->
            <tr ng-switch-when="true">
                <td><a href="/sgw/{{d.name}}/"><span class="sgw-name">{{d.name}}</span></a></td>
                <td colspan="4">
                    <table>
                        <tr>
                            <td><strong>Sync Function</strong></td>
                            <td><textarea class="syncfunction" ng-model="d.extra.sync_copy"
                                          ui-codemirror="editorOptions"></textarea></td>

                        </tr>
                    </table>
                </td>
                <td style="text-align: right;">
                    <button class="btn btn-success btn-sm" ng-click="row.configure=false;saveSyncFunction($index)">save
                    </button>
                    &nbsp;
                    <button class="btn btn-danger btn-sm" ng-click="row.configure=false;cancelSaveSyncFunction($index)">
                        cancel
                    </button>
                </td>
            </tr>
            </tbody>
        </table>


    </div>
</div>

<div ng-show="auth.checked">
    <div ng-show="!auth.loggedin">
        <h1>Dashboard</h1>
        <br/>

        <p>
            Please <a ng-click="login()">log in</a> to make use of this
            service. It's quick and easy (and you don't even need to
            register!)
        </p>
    </div>
</div>


<script>
    $(function () {
        ZeroClipboard.setDefaults({ moviePath: '/static/swf/ZeroClipboard.swf' });
    });
</script>
